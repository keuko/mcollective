<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class MCollective::DDL::Base - mcollective version 2.12.0</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-findddlfile">#findddlfile</a>
    
    <li ><a href="#method-i-help">#help</a>
    
    <li ><a href="#method-i-input">#input</a>
    
    <li ><a href="#method-i-loadddlfile">#loadddlfile</a>
    
    <li ><a href="#method-i-metadata">#metadata</a>
    
    <li ><a href="#method-i-output">#output</a>
    
    <li ><a href="#method-i-requires">#requires</a>
    
    <li ><a href="#method-i-template_for_plugintype">#template_for_plugintype</a>
    
    <li ><a href="#method-i-validate_input_argument">#validate_input_argument</a>
    
    <li ><a href="#method-i-validate_requirements">#validate_requirements</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-MCollective::DDL::Base">
  <h1 id="class-MCollective::DDL::Base" class="class">
    class MCollective::DDL::Base
  </h1>

  <section class="description">
    
<p>The base class for all kinds of <a href="../DDL.html">DDL</a> files.  <a
href="../DDL.html">DDL</a> files when run gets parsed and builds up a hash
of the basic primitive types, ideally restricted so it can be converted to
JSON though today there are some Ruby Symbols in them which might be fixed
laster on.</p>

<p>The Hash being built should be stored in @entities, the format is generally
not prescribed but there&#39;s a definite feel to how <a
href="../DDL.html">DDL</a> files look so study the agent and discovery ones
to see how the structure applies to very different use cases.</p>

<p>For every plugin type you should have a single word name - that corresponds
to the directory in the libdir where these plugins live.  If you need
anything above and beyond &#39;metadata&#39; in your plugin <a
href="../DDL.html">DDL</a> then add a PlugintypeDDL class here and add your
specific behaviors to those.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-entities" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">entities</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-meta" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">meta</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-pluginname" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">pluginname</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-plugintype" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">plugintype</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-requirements" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">requirements</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-usage" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">usage</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(plugin, plugintype=:agent, loadddl=true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">plugin</span>, <span class="ruby-identifier">plugintype</span>=<span class="ruby-value">:agent</span>, <span class="ruby-identifier">loadddl</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-ivar">@entities</span> = {}
  <span class="ruby-ivar">@meta</span> = {}
  <span class="ruby-ivar">@usage</span> = <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-ivar">@config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>
  <span class="ruby-ivar">@pluginname</span> = <span class="ruby-identifier">plugin</span>
  <span class="ruby-ivar">@plugintype</span> = <span class="ruby-identifier">plugintype</span>.<span class="ruby-identifier">to_sym</span>
  <span class="ruby-ivar">@requirements</span> = {}

  <span class="ruby-identifier">loadddlfile</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">loadddl</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-findddlfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">findddlfile</span><span
            class="method-args">(ddlname=nil, ddltype=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="findddlfile-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 87</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">findddlfile</span>(<span class="ruby-identifier">ddlname</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">ddltype</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">ddlname</span> = <span class="ruby-ivar">@pluginname</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ddlname</span>
  <span class="ruby-identifier">ddltype</span> = <span class="ruby-ivar">@plugintype</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ddltype</span>

  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">libdir</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">libdir</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">ddlfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>([<span class="ruby-identifier">libdir</span>, <span class="ruby-string">&quot;mcollective&quot;</span>, <span class="ruby-identifier">ddltype</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-node">&quot;#{ddlname}.ddl&quot;</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">ddlfile</span>)
      <span class="ruby-constant">Log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Found #{ddlname} ddl at #{ddlfile}&quot;</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">ddlfile</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-help" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">help</span><span
            class="method-args">(template=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Generates help using the template based on the data created with metadata
and input.</p>

<p>If no template name is provided one will be chosen based on the plugin
type.  If the provided template path is not absolute then the template will
be loaded either from the config dir and if that does not exist, default to
/etc/mcollective</p>
          
          

          
          <div class="method-source-code" id="help-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">help</span>(<span class="ruby-identifier">template</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">template</span> = <span class="ruby-identifier">template_for_plugintype</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">template</span>
  <span class="ruby-identifier">template</span> = <span class="ruby-constant">Util</span>.<span class="ruby-identifier">templatepath</span>(<span class="ruby-identifier">template</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">absolute_path?</span>(<span class="ruby-identifier">template</span>)

  <span class="ruby-identifier">template</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">template</span>)
  <span class="ruby-identifier">meta</span> = <span class="ruby-ivar">@meta</span>
  <span class="ruby-identifier">entities</span> = <span class="ruby-ivar">@entities</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">template</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;metadata-help.erb&quot;</span>
    <span class="ruby-identifier">metadata_template</span> = <span class="ruby-constant">Util</span>.<span class="ruby-identifier">templatepath</span>(<span class="ruby-string">&quot;metadata-help.erb&quot;</span>)
    <span class="ruby-identifier">metadata_template</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">metadata_template</span>)
    <span class="ruby-identifier">metastring</span> = <span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata_template</span>, <span class="ruby-value">0</span>, <span class="ruby-string">&#39;%&#39;</span>)
    <span class="ruby-identifier">metastring</span> = <span class="ruby-identifier">metastring</span>.<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">erb</span> = <span class="ruby-constant">ERB</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">template</span>, <span class="ruby-value">0</span>, <span class="ruby-string">&#39;%&#39;</span>)
  <span class="ruby-identifier">erb</span>.<span class="ruby-identifier">result</span>(<span class="ruby-identifier">binding</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-input" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">input</span><span
            class="method-args">(argument, properties)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Registers an input argument for a given action</p>

<p>See the documentation for action for how to use this</p>
          
          

          
          <div class="method-source-code" id="input-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">input</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">properties</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Cannot figure out what entity input #{argument} belongs to&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@current_entity</span>

  <span class="ruby-identifier">entity</span> = <span class="ruby-ivar">@current_entity</span>

  [<span class="ruby-value">:prompt</span>, <span class="ruby-value">:description</span>, <span class="ruby-value">:type</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Input needs a :#{arg} property&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">arg</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-value">:input</span>][<span class="ruby-identifier">argument</span>] = {<span class="ruby-value">:prompt</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:prompt</span>],
                                         <span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:description</span>],
                                         <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:type</span>],
                                         <span class="ruby-value">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:default</span>],
                                         <span class="ruby-value">:optional</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:optional</span>]}

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:type</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-value">:string</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Input type :string needs a :validation argument&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:validation</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Input type :string needs a :maxlength argument&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:maxlength</span>)

      <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-value">:input</span>][<span class="ruby-identifier">argument</span>][<span class="ruby-value">:validation</span>] = <span class="ruby-identifier">properties</span>[<span class="ruby-value">:validation</span>]
      <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-value">:input</span>][<span class="ruby-identifier">argument</span>][<span class="ruby-value">:maxlength</span>] = <span class="ruby-identifier">properties</span>[<span class="ruby-value">:maxlength</span>]

    <span class="ruby-keyword">when</span> <span class="ruby-value">:list</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Input type :list needs a :list argument&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:list</span>)

      <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">entity</span>][<span class="ruby-value">:input</span>][<span class="ruby-identifier">argument</span>][<span class="ruby-value">:list</span>] = <span class="ruby-identifier">properties</span>[<span class="ruby-value">:list</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-loadddlfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">loadddlfile</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="loadddlfile-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 79</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">loadddlfile</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">ddlfile</span> = <span class="ruby-identifier">findddlfile</span>
    <span class="ruby-identifier">instance_eval</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">ddlfile</span>), <span class="ruby-identifier">ddlfile</span>, <span class="ruby-value">1</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;Can&#39;t find DDL for #{@plugintype} plugin &#39;#{@pluginname}&#39;&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-metadata" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">metadata</span><span
            class="method-args">(meta)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Registers meta data for the introspection hash</p>
          
          

          
          <div class="method-source-code" id="metadata-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">metadata</span>(<span class="ruby-identifier">meta</span>)
  [<span class="ruby-value">:name</span>, <span class="ruby-value">:description</span>, <span class="ruby-value">:author</span>, <span class="ruby-value">:license</span>, <span class="ruby-value">:version</span>, <span class="ruby-value">:url</span>, <span class="ruby-value">:timeout</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Metadata needs a :#{arg} property&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">meta</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">arg</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@meta</span> = <span class="ruby-identifier">meta</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output</span><span
            class="method-args">(argument, properties)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Registers an output argument for a given action</p>

<p>See the documentation for action for how to use this</p>
          
          

          
          <div class="method-source-code" id="output-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">properties</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Cannot figure out what action input #{argument} belongs to&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@current_entity</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Output #{argument} needs a description argument&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:description</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Output #{argument} needs a display_as argument&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">properties</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">:display_as</span>)

  <span class="ruby-identifier">action</span> = <span class="ruby-ivar">@current_entity</span>

  <span class="ruby-ivar">@entities</span>[<span class="ruby-identifier">action</span>][<span class="ruby-value">:output</span>][<span class="ruby-identifier">argument</span>] = {<span class="ruby-value">:description</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:description</span>],
                                          <span class="ruby-value">:display_as</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:display_as</span>],
                                          <span class="ruby-value">:default</span>     =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">properties</span>[<span class="ruby-value">:default</span>]}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-requires" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">requires</span><span
            class="method-args">(requirement)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="requires-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">requires</span>(<span class="ruby-identifier">requirement</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Requirement should be a hash in the form :item =&gt; &#39;requirement&#39;&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">requirement</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)

  <span class="ruby-identifier">valid_requirements</span> = [<span class="ruby-value">:mcollective</span>]

  <span class="ruby-identifier">requirement</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">valid_requirements</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;Requirement %s is not a valid requirement, only %s is supported&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">key</span>, <span class="ruby-identifier">valid_requirements</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;, &quot;</span>)]
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@requirements</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">requirement</span>[<span class="ruby-identifier">key</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">validate_requirements</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-template_for_plugintype" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">template_for_plugintype</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="template_for_plugintype-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">template_for_plugintype</span>
  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@plugintype</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:agent</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;rpc-help.erb&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">Util</span>.<span class="ruby-identifier">templatepath</span>(<span class="ruby-node">&quot;#{@plugintype}-help.erb&quot;</span>))
      <span class="ruby-keyword">return</span> <span class="ruby-node">&quot;#{@plugintype}-help.erb&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># Default help template gets loaded if plugintype-help does not exist.</span>
      <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;metadata-help.erb&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_input_argument" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_input_argument</span><span
            class="method-args">(input, key, argument)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>validate strings, lists and booleans, we&#39;ll add more types of
validators when all the use cases are clear</p>

<p>only does validation for arguments actually given, since some might be
optional.  We validate the presense of the argument earlier so this is a
safe assumption, just to skip them.</p>

<p>:string can have maxlength and regex.  A maxlength of 0 will bypasss checks
:list has a array of valid values</p>
          
          

          
          <div class="method-source-code" id="validate_input_argument-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_input_argument</span>(<span class="ruby-identifier">input</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">argument</span>)
  <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">load_validators</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">input</span>[<span class="ruby-identifier">key</span>][<span class="ruby-value">:type</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-value">:string</span>
    <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">validate</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-value">:string</span>)

    <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">length</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">input</span>[<span class="ruby-identifier">key</span>][<span class="ruby-value">:maxlength</span>].<span class="ruby-identifier">to_i</span>)

    <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">validate</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">input</span>[<span class="ruby-identifier">key</span>][<span class="ruby-value">:validation</span>])

  <span class="ruby-keyword">when</span> <span class="ruby-value">:list</span>
    <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">validate</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">input</span>[<span class="ruby-identifier">key</span>][<span class="ruby-value">:list</span>])

  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Validator</span>.<span class="ruby-identifier">validate</span>(<span class="ruby-identifier">argument</span>, <span class="ruby-identifier">input</span>[<span class="ruby-identifier">key</span>][<span class="ruby-value">:type</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">DDLValidationError</span>, <span class="ruby-string">&quot;Cannot validate input %s: %s&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">key</span>, <span class="ruby-identifier">e</span>.<span class="ruby-identifier">to_s</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-validate_requirements" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">validate_requirements</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="validate_requirements-source">
            <pre><span class="ruby-comment"># File lib/mcollective/ddl/base.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">validate_requirements</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">requirement</span> = <span class="ruby-ivar">@requirements</span>[<span class="ruby-value">:mcollective</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">versioncmp</span>(<span class="ruby-constant">Util</span>.<span class="ruby-identifier">mcollective_version</span>, <span class="ruby-identifier">requirement</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">DDLValidationError</span>, <span class="ruby-string">&quot;%s plugin &#39;%s&#39; requires MCollective version %s or newer&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-ivar">@plugintype</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">capitalize</span>, <span class="ruby-ivar">@pluginname</span>, <span class="ruby-identifier">requirement</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

