<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module MCollective::Util - mcollective version 2.12.0</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-absolute_path-3F">::absolute_path?</a>
    
    <li ><a href="#method-c-align_text">::align_text</a>
    
    <li ><a href="#method-c-color">::color</a>
    
    <li ><a href="#method-c-colorize">::colorize</a>
    
    <li ><a href="#method-c-command_in_path-3F">::command_in_path?</a>
    
    <li ><a href="#method-c-config_file_for_user">::config_file_for_user</a>
    
    <li ><a href="#method-c-default_options">::default_options</a>
    
    <li ><a href="#method-c-empty_filter">::empty_filter</a>
    
    <li ><a href="#method-c-empty_filter-3F">::empty_filter?</a>
    
    <li ><a href="#method-c-field_number">::field_number</a>
    
    <li ><a href="#method-c-field_size">::field_size</a>
    
    <li ><a href="#method-c-get_fact">::get_fact</a>
    
    <li ><a href="#method-c-get_hidden_input">::get_hidden_input</a>
    
    <li ><a href="#method-c-get_hidden_input_on_unix">::get_hidden_input_on_unix</a>
    
    <li ><a href="#method-c-get_hidden_input_on_windows">::get_hidden_input_on_windows</a>
    
    <li ><a href="#method-c-has_agent-3F">::has_agent?</a>
    
    <li ><a href="#method-c-has_cf_class-3F">::has_cf_class?</a>
    
    <li ><a href="#method-c-has_fact-3F">::has_fact?</a>
    
    <li ><a href="#method-c-has_identity-3F">::has_identity?</a>
    
    <li ><a href="#method-c-loadclass">::loadclass</a>
    
    <li ><a href="#method-c-make_subscriptions">::make_subscriptions</a>
    
    <li ><a href="#method-c-mcollective_version">::mcollective_version</a>
    
    <li ><a href="#method-c-parse_fact_string">::parse_fact_string</a>
    
    <li ><a href="#method-c-ruby_version">::ruby_version</a>
    
    <li ><a href="#method-c-setup_windows_sleeper">::setup_windows_sleeper</a>
    
    <li ><a href="#method-c-shellescape">::shellescape</a>
    
    <li ><a href="#method-c-str_to_bool">::str_to_bool</a>
    
    <li ><a href="#method-c-subscribe">::subscribe</a>
    
    <li ><a href="#method-c-subscribe_to_direct_addressing_queue">::subscribe_to_direct_addressing_queue</a>
    
    <li ><a href="#method-c-templatepath">::templatepath</a>
    
    <li ><a href="#method-c-terminal_dimensions">::terminal_dimensions</a>
    
    <li ><a href="#method-c-unsubscribe">::unsubscribe</a>
    
    <li ><a href="#method-c-versioncmp">::versioncmp</a>
    
    <li ><a href="#method-c-windows-3F">::windows?</a>
    
    <li ><a href="#method-c-windows_prefix">::windows_prefix</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-MCollective::Util">
  <h1 id="module-MCollective::Util" class="module">
    module MCollective::Util
  </h1>

  <section class="description">
    
<p>Some basic utility helper methods useful to clients, agents, runner etc.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-absolute_path-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">absolute_path?</span><span
            class="method-args">(path, separator=File::SEPARATOR, alt_separator=File::ALT_SEPARATOR)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>we should really use Pathname#absolute? but it&#39;s not in all the ruby
versions we support and it comes down to roughly this</p>
          
          

          
          <div class="method-source-code" id="absolute_path-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 473</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">absolute_path?</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">separator</span>=<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">SEPARATOR</span>, <span class="ruby-identifier">alt_separator</span>=<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">ALT_SEPARATOR</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">alt_separator</span>
    <span class="ruby-identifier">path_matcher</span> = <span class="ruby-node">/^([a-zA-Z]:){0,1}[#{Regexp.quote alt_separator}#{Regexp.quote separator}]/</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">path_matcher</span> = <span class="ruby-node">/^#{Regexp.quote separator}/</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">path</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">path_matcher</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-align_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">align_text</span><span
            class="method-args">(text, console_cols = nil, preamble = 5)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an aligned_string of text relative to the size of the terminal
window. If a line in the string exceeds the width of the terminal window
the line will be chopped off at the whitespace chacter closest to the end
of the line and prepended to the next line, keeping all indentation.</p>

<p>The terminal size is detected by default, but custom line widths can
passed. All strings will also be left aligned with 5 whitespace characters
by default.</p>
          
          

          
          <div class="method-source-code" id="align_text-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">align_text</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">console_cols</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">preamble</span> = <span class="ruby-value">5</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">console_cols</span>
    <span class="ruby-identifier">console_cols</span> = <span class="ruby-identifier">terminal_dimensions</span>[<span class="ruby-value">0</span>]

    <span class="ruby-comment"># if unknown size we default to the typical unix default</span>
    <span class="ruby-identifier">console_cols</span> = <span class="ruby-value">80</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">console_cols</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">console_cols</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">preamble</span>

  <span class="ruby-comment"># Return unaligned text if console window is too small</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">text</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">console_cols</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>

  <span class="ruby-comment"># If console is 0 this implies unknown so we assume the common</span>
  <span class="ruby-comment"># minimal unix configuration of 80 characters</span>
  <span class="ruby-identifier">console_cols</span> = <span class="ruby-value">80</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">console_cols</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&quot;\n&quot;</span>)
  <span class="ruby-identifier">piece</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">whitespace</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">whitespace</span> = <span class="ruby-value">0</span>

    <span class="ruby-keyword">while</span> <span class="ruby-identifier">whitespace</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span>[<span class="ruby-identifier">whitespace</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39; &#39;</span>
      <span class="ruby-identifier">whitespace</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If the current line is empty, indent it so that a snippet</span>
    <span class="ruby-comment"># from the previous line is aligned correctly.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
      <span class="ruby-identifier">line</span> = (<span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">whitespace</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If text was snipped from the previous line, prepend it to the</span>
    <span class="ruby-comment"># current line after any current indentation.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">piece</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span>
      <span class="ruby-comment"># Reset whitespaces to 0 if there are more whitespaces than there are</span>
      <span class="ruby-comment"># console columns</span>
      <span class="ruby-identifier">whitespace</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">whitespace</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">console_cols</span>

      <span class="ruby-comment"># If the current line is empty and being prepended to, create a new</span>
      <span class="ruby-comment"># empty line in the text so that formatting is preserved.</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>[<span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">==</span> (<span class="ruby-string">&quot; &quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">whitespace</span>)
        <span class="ruby-identifier">text</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-string">&quot;&quot;</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># Add the snipped text to the current line</span>
      <span class="ruby-identifier">line</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-identifier">whitespace</span>, <span class="ruby-node">&quot;#{piece} &quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">piece</span> = <span class="ruby-string">&#39;&#39;</span>

    <span class="ruby-comment"># Compare the line length to the allowed line length.</span>
    <span class="ruby-comment"># If it exceeds it, snip the offending text from the line</span>
    <span class="ruby-comment"># and store it so that it can be prepended to the next line.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> (<span class="ruby-identifier">console_cols</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">preamble</span>)
      <span class="ruby-identifier">reverse</span> = <span class="ruby-identifier">console_cols</span>

      <span class="ruby-keyword">while</span> <span class="ruby-identifier">line</span>[<span class="ruby-identifier">reverse</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39; &#39;</span>
        <span class="ruby-identifier">reverse</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">piece</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-identifier">reverse</span>, (<span class="ruby-identifier">line</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)).<span class="ruby-identifier">lstrip</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If a snippet exists when all the columns in the text have been</span>
    <span class="ruby-comment"># updated, create a new line and append the snippet to it, using</span>
    <span class="ruby-comment"># the same left alignment as the last line in the text.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">piece</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">text</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>].<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">text</span>[<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>] = <span class="ruby-node">&quot;#{&#39; &#39; * (whitespace)}#{piece}&quot;</span>
      <span class="ruby-identifier">piece</span> = <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Add the preamble to the line and add it to the text</span>
    <span class="ruby-identifier">line</span> = ((<span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">preamble</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">line</span>)
    <span class="ruby-identifier">text</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">line</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-color" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">color</span><span
            class="method-args">(code)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return color codes, if the config color= option is false just return a
empty string</p>
          
          

          
          <div class="method-source-code" id="color-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">color</span>(<span class="ruby-identifier">code</span>)
  <span class="ruby-identifier">colorize</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">color</span>

  <span class="ruby-identifier">colors</span> = {<span class="ruby-value">:red</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[31m&quot;</span>,
            <span class="ruby-value">:green</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[32m&quot;</span>,
            <span class="ruby-value">:yellow</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[33m&quot;</span>,
            <span class="ruby-value">:cyan</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[36m&quot;</span>,
            <span class="ruby-value">:bold</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[1m&quot;</span>,
            <span class="ruby-value">:reset</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;[0m&quot;</span>}

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">colorize</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">colors</span>[<span class="ruby-identifier">code</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-colorize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">colorize</span><span
            class="method-args">(code, msg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Helper to return a string in specific color</p>
          
          

          
          <div class="method-source-code" id="colorize-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 297</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">colorize</span>(<span class="ruby-identifier">code</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-string">&quot;%s%s%s&quot;</span> <span class="ruby-operator">%</span> [ <span class="ruby-identifier">color</span>(<span class="ruby-identifier">code</span>), <span class="ruby-identifier">msg</span>, <span class="ruby-identifier">color</span>(<span class="ruby-value">:reset</span>) ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-command_in_path-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">command_in_path?</span><span
            class="method-args">(command)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks in PATH returns true if the command is found</p>
          
          

          
          <div class="method-source-code" id="command_in_path-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_in_path?</span>(<span class="ruby-identifier">command</span>)
  <span class="ruby-identifier">found</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;PATH&quot;</span>].<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">p</span>, <span class="ruby-identifier">command</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">found</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-config_file_for_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">config_file_for_user</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Picks a config file defaults to ~/.mcollective else
/etc/mcollective/client.cfg</p>
          
          

          
          <div class="method-source-code" id="config_file_for_user-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">config_file_for_user</span>
  <span class="ruby-comment"># the set of acceptable config files</span>
  <span class="ruby-identifier">config_paths</span> = []

  <span class="ruby-comment"># user dotfile</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-comment"># File.expand_path will raise if HOME isn&#39;t set, catch it</span>
    <span class="ruby-identifier">user_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-string">&quot;~/.mcollective&quot;</span>)
    <span class="ruby-identifier">config_paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">user_path</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># standard locations</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">windows?</span>
    <span class="ruby-identifier">config_paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">windows_prefix</span>, <span class="ruby-string">&#39;etc&#39;</span>, <span class="ruby-string">&#39;client.cfg&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">config_paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;/etc/puppetlabs/mcollective/client.cfg&#39;</span>
    <span class="ruby-identifier">config_paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;/etc/mcollective/client.cfg&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># use the first readable config file, or if none are the first listed</span>
  <span class="ruby-identifier">found</span> = <span class="ruby-identifier">config_paths</span>.<span class="ruby-identifier">find_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">readable?</span>(<span class="ruby-identifier">file</span>) } <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">config_paths</span>[<span class="ruby-identifier">found</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-default_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a standard options hash</p>
          
          

          
          <div class="method-source-code" id="default_options-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_options</span>
  {<span class="ruby-value">:verbose</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>,
   <span class="ruby-value">:disctimeout</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
   <span class="ruby-value">:timeout</span>           =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>,
   <span class="ruby-value">:config</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">config_file_for_user</span>,
   <span class="ruby-value">:collective</span>        =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
   <span class="ruby-value">:discovery_method</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>,
   <span class="ruby-value">:discovery_options</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">default_discovery_options</span>,
   <span class="ruby-value">:filter</span>            =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">empty_filter</span>}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-empty_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_filter</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates an empty filter</p>
          
          

          
          <div class="method-source-code" id="empty_filter-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 141</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">empty_filter</span>
  {<span class="ruby-string">&quot;fact&quot;</span>     =<span class="ruby-operator">&gt;</span> [],
   <span class="ruby-string">&quot;cf_class&quot;</span> =<span class="ruby-operator">&gt;</span> [],
   <span class="ruby-string">&quot;agent&quot;</span>    =<span class="ruby-operator">&gt;</span> [],
   <span class="ruby-string">&quot;identity&quot;</span> =<span class="ruby-operator">&gt;</span> [],
   <span class="ruby-string">&quot;compound&quot;</span> =<span class="ruby-operator">&gt;</span> []}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-empty_filter-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty_filter?</span><span
            class="method-args">(filter)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if the passed in filter is an empty one</p>
          
          

          
          <div class="method-source-code" id="empty_filter-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">empty_filter?</span>(<span class="ruby-identifier">filter</span>)
  <span class="ruby-identifier">filter</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">empty_filter</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">filter</span> <span class="ruby-operator">==</span> {}
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-field_number" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">field_number</span><span
            class="method-args">(field_size, max_size=90)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Calculate number of fields for printing</p>
          
          

          
          <div class="method-source-code" id="field_number-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 519</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">field_number</span>(<span class="ruby-identifier">field_size</span>, <span class="ruby-identifier">max_size</span>=<span class="ruby-value">90</span>)
  <span class="ruby-identifier">number</span> = (<span class="ruby-identifier">max_size</span><span class="ruby-operator">/</span><span class="ruby-identifier">field_size</span>).<span class="ruby-identifier">to_i</span>
  (<span class="ruby-identifier">number</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">number</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-field_size" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">field_size</span><span
            class="method-args">(elements, min_size=40)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Get field size for printing</p>
          
          

          
          <div class="method-source-code" id="field_size-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 513</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">field_size</span>(<span class="ruby-identifier">elements</span>, <span class="ruby-identifier">min_size</span>=<span class="ruby-value">40</span>)
  <span class="ruby-identifier">max_length</span> = <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">max_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">length</span> }.<span class="ruby-identifier">length</span>
  <span class="ruby-identifier">max_length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">min_size</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">max_length</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">min_size</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_fact" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_fact</span><span
            class="method-args">(fact)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gets the value of a specific fact, mostly just a duplicate of <a
href="Facts.html#method-c-get_fact">MCollective::Facts.get_fact</a> but it
kind of goes with the other classes here</p>
          
          

          
          <div class="method-source-code" id="get_fact-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_fact</span>(<span class="ruby-identifier">fact</span>)
  <span class="ruby-constant">Facts</span>.<span class="ruby-identifier">get_fact</span>(<span class="ruby-identifier">fact</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_hidden_input" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_hidden_input</span><span
            class="method-args">(message='Please enter data: ')</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_hidden_input-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 560</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_hidden_input</span>(<span class="ruby-identifier">message</span>=<span class="ruby-string">&#39;Please enter data: &#39;</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">print</span> <span class="ruby-identifier">message</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">versioncmp</span>(<span class="ruby-identifier">ruby_version</span>, <span class="ruby-string">&#39;1.9.3&#39;</span>) <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;io/console&#39;</span>
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">noecho</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:gets</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># Use hacks to get hidden input on Ruby &lt;1.9.3</span>
    <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">windows?</span>
      <span class="ruby-identifier">input</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_hidden_input_on_windows</span>()
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">input</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_hidden_input_on_unix</span>()
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">input</span>.<span class="ruby-identifier">chomp!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>
  <span class="ruby-identifier">input</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_hidden_input_on_unix" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_hidden_input_on_unix</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_hidden_input_on_unix-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 545</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_hidden_input_on_unix</span>()
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">tty?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Could not hook to stdin to hide input. If using SSH, try using -t flag while connecting to server.&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">system</span> <span class="ruby-string">&#39;stty -echo -icanon&#39;</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Could not hide input using stty command.&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">input</span> = <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">gets</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">system</span> <span class="ruby-string">&#39;stty echo icanon&#39;</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-string">&#39;Could not enable echoing of input. Try executing `stty echo icanon` to debug.&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">input</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get_hidden_input_on_windows" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_hidden_input_on_windows</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_hidden_input_on_windows-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 524</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">get_hidden_input_on_windows</span>()
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;Win32API&#39;</span>
  <span class="ruby-comment"># Hook into getch from crtdll. Keep reading all keys till return</span>
  <span class="ruby-comment"># or newline is hit.</span>
  <span class="ruby-comment"># If key is backspace or delete, then delete the character and update</span>
  <span class="ruby-comment"># the buffer.</span>
  <span class="ruby-identifier">input</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">char</span> = <span class="ruby-constant">Win32API</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;crtdll&quot;</span>, <span class="ruby-string">&quot;_getch&quot;</span>, [ ], <span class="ruby-string">&quot;I&quot;</span>).<span class="ruby-constant">Call</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-value">10</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-value">13</span> <span class="ruby-comment"># return or newline</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-value">127</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-value">8</span> <span class="ruby-comment"># backspace and delete</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
        <span class="ruby-identifier">input</span>.<span class="ruby-identifier">slice!</span>(<span class="ruby-value">-1</span>, <span class="ruby-value">1</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">input</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">char</span>.<span class="ruby-identifier">chr</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">char</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">input</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-has_agent-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_agent?</span><span
            class="method-args">(agent)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Finds out if this <a href="../MCollective.html">MCollective</a> has an
agent by the name passed</p>

<p>If the passed name starts with a / it&#39;s assumed to be regex and will
use regex to match</p>
          
          

          
          <div class="method-source-code" id="has_agent-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_agent?</span>(<span class="ruby-identifier">agent</span>)
  <span class="ruby-identifier">agent</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">agent</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\/&quot;</span>, <span class="ruby-string">&quot;&quot;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&quot;^/&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">agent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-constant">Agents</span>.<span class="ruby-identifier">agentlist</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-identifier">agent</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Agents</span>.<span class="ruby-identifier">agentlist</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">agent</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-has_cf_class-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_cf_class?</span><span
            class="method-args">(klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if this node has a configuration management class by parsing the a
text file with just a list of classes, recipes, roles etc.  This is ala the
classes.txt from puppet.</p>

<p>If the passed name starts with a / it&#39;s assumed to be regex and will
use regex to match</p>
          
          

          
          <div class="method-source-code" id="has_cf_class-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 38</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_cf_class?</span>(<span class="ruby-identifier">klass</span>)
  <span class="ruby-identifier">klass</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">klass</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\/&quot;</span>, <span class="ruby-string">&quot;&quot;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&quot;^/&quot;</span>)
  <span class="ruby-identifier">cfile</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">classesfile</span>

  <span class="ruby-constant">Log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Looking for configuration management classes in #{cfile}&quot;</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">readlines</span>(<span class="ruby-identifier">cfile</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">klass</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">chomp</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">klass</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-constant">Log</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Parsing classes file &#39;#{cfile}&#39; failed: #{e.class}: #{e}&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-has_fact-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_fact?</span><span
            class="method-args">(fact, value, operator)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Compares fact == value,</p>

<p>If the passed value starts with a / it&#39;s assumed to be regex and will
use regex to match</p>
          
          

          
          <div class="method-source-code" id="has_fact-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_fact?</span>(<span class="ruby-identifier">fact</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">operator</span>)

  <span class="ruby-constant">Log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;Comparing #{fact} #{operator} #{value}&quot;</span>)
  <span class="ruby-constant">Log</span>.<span class="ruby-identifier">debug</span>(<span class="ruby-node">&quot;where :fact = &#39;#{fact}&#39;, :operator = &#39;#{operator}&#39;, :value = &#39;#{value}&#39;&quot;</span>)

  <span class="ruby-identifier">fact</span> = <span class="ruby-constant">Facts</span>[<span class="ruby-identifier">fact</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">fact</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">fact</span> = <span class="ruby-identifier">fact</span>.<span class="ruby-identifier">clone</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">fact</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">fact</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span> <span class="ruby-identifier">test_fact_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">operator</span>)}
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">fact</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span> <span class="ruby-identifier">test_fact_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">operator</span>)}
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">test_fact_value</span>(<span class="ruby-identifier">fact</span>, <span class="ruby-identifier">value</span>, <span class="ruby-identifier">operator</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-has_identity-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_identity?</span><span
            class="method-args">(identity)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if the configured identity matches the one supplied</p>

<p>If the passed name starts with a / it&#39;s assumed to be regex and will
use regex to match</p>
          
          

          
          <div class="method-source-code" id="has_identity-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">has_identity?</span>(<span class="ruby-identifier">identity</span>)
  <span class="ruby-identifier">identity</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">identity</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\/&quot;</span>, <span class="ruby-string">&quot;&quot;</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">identity</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&quot;^/&quot;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">identity</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">identity</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">identity</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">identity</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">identity</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-loadclass" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">loadclass</span><span
            class="method-args">(klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Wrapper around <a
href="PluginManager.html#method-c-loadclass">MCollective::PluginManager.loadclass</a></p>
          
          

          
          <div class="method-source-code" id="loadclass-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">loadclass</span>(<span class="ruby-identifier">klass</span>)
  <span class="ruby-constant">PluginManager</span>.<span class="ruby-identifier">loadclass</span>(<span class="ruby-identifier">klass</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-make_subscriptions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_subscriptions</span><span
            class="method-args">(agent, type, collective=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="make_subscriptions-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 194</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_subscriptions</span>(<span class="ruby-identifier">agent</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">collective</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>

  <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;Unknown target type #{type}&quot;</span>) <span class="ruby-keyword">unless</span> [<span class="ruby-value">:broadcast</span>, <span class="ruby-value">:directed</span>, <span class="ruby-value">:reply</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">type</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">collective</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">config</span>.<span class="ruby-identifier">collectives</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
      {<span class="ruby-value">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">agent</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:collective</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;Unknown collective &#39;#{collective}&#39; known collectives are &#39;#{config.collectives.join &#39;, &#39;}&#39;&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">collectives</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">collective</span>)

    [{<span class="ruby-value">:agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">agent</span>, <span class="ruby-value">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type</span>, <span class="ruby-value">:collective</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">collective</span>}]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mcollective_version" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mcollective_version</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mcollective_version-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 307</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">mcollective_version</span>
  <span class="ruby-constant">MCollective</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-parse_fact_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_fact_string</span><span
            class="method-args">(fact)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Parse a fact filter string like foo=bar into the tuple hash thats needed</p>
          
          

          
          <div class="method-source-code" id="parse_fact_string-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 238</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse_fact_string</span>(<span class="ruby-identifier">fact</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">fact</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([^ ]+?)[ ]*=&gt;[ ]*(.+)/</span>
    <span class="ruby-keyword">return</span> {<span class="ruby-value">:fact</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span>, <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$2</span>, <span class="ruby-value">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;&gt;=&#39;</span> }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">fact</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([^ ]+?)[ ]*=&lt;[ ]*(.+)/</span>
    <span class="ruby-keyword">return</span> {<span class="ruby-value">:fact</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span>, <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$2</span>, <span class="ruby-value">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;&lt;=&#39;</span> }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">fact</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([^ ]+?)[ ]*(&lt;=|&gt;=|&lt;|&gt;|!=|==|=~)[ ]*(.+)/</span>
    <span class="ruby-keyword">return</span> {<span class="ruby-value">:fact</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span>, <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$3</span>, <span class="ruby-value">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$2</span> }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">fact</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(.+?)[ ]*=[ ]*\/(.+)\/$/</span>
    <span class="ruby-keyword">return</span> {<span class="ruby-value">:fact</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span>, <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;/#{$2}/&quot;</span>, <span class="ruby-value">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;=~&#39;</span> }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">fact</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^([^= ]+?)[ ]*=[ ]*(.+)/</span>
    <span class="ruby-keyword">return</span> {<span class="ruby-value">:fact</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$1</span>, <span class="ruby-value">:value</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">$2</span>, <span class="ruby-value">:operator</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;==&#39;</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Could not parse fact #{fact} it does not appear to be in a valid format&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-ruby_version" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ruby_version</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the current ruby version as per RUBY_VERSION, mostly doing this
here to aid testing</p>
          
          

          
          <div class="method-source-code" id="ruby_version-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 303</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ruby_version</span>
  <span class="ruby-constant">RUBY_VERSION</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_windows_sleeper" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_windows_sleeper</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>On windows ^c can&#39;t interrupt the VM if its blocking on IO, so this
sets up a dummy thread that sleeps and this will have the end result of
being interruptable at least once a second.  This is a common pattern found
in Rails etc</p>
          
          

          
          <div class="method-source-code" id="setup_windows_sleeper-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 28</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">setup_windows_sleeper</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">loop</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span> } } <span class="ruby-keyword">if</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">windows?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-shellescape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shellescape</span><span
            class="method-args">(str)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Escapes a string so it&#39;s safe to use in system() or backticks</p>

<p>Taken from Shellwords#shellescape since it&#39;s only in a few ruby
versions</p>
          
          

          
          <div class="method-source-code" id="shellescape-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shellescape</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&quot;&#39;&#39;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">str</span> = <span class="ruby-identifier">str</span>.<span class="ruby-identifier">dup</span>

  <span class="ruby-comment"># Process as a single byte sequence because not all shell</span>
  <span class="ruby-comment"># implementations are multibyte aware.</span>
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/([^A-Za-z0-9_\-.,:\/@\n])/n</span>, <span class="ruby-string">&quot;\\\\\\1&quot;</span>)

  <span class="ruby-comment"># A LF cannot be escaped with a backslash because a backslash + LF</span>
  <span class="ruby-comment"># combo is regarded as line continuation and simply ignored.</span>
  <span class="ruby-identifier">str</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\n/</span>, <span class="ruby-string">&quot;&#39;\n&#39;&quot;</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">str</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-str_to_bool" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">str_to_bool</span><span
            class="method-args">(val)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts a string into a boolean value Strings matching 1,y,yes,true or t
will return TrueClass Any other value will return FalseClass</p>
          
          

          
          <div class="method-source-code" id="str_to_bool-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 486</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">str_to_bool</span>(<span class="ruby-identifier">val</span>)
  <span class="ruby-identifier">clean_val</span> = <span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">clean_val</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(1|yes|true|y|t)$/i</span>
    <span class="ruby-keyword">return</span>  <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">clean_val</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(0|no|false|n|f)$/i</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span>(<span class="ruby-node">&quot;Cannot convert string value &#39;#{clean_val}&#39; into a boolean.&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-subscribe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">subscribe</span><span
            class="method-args">(targets)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Helper to subscribe to a topic on multiple collectives or just one</p>
          
          

          
          <div class="method-source-code" id="subscribe-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">subscribe</span>(<span class="ruby-identifier">targets</span>)
  <span class="ruby-identifier">connection</span> = <span class="ruby-constant">PluginManager</span>[<span class="ruby-string">&quot;connector_plugin&quot;</span>]

  <span class="ruby-identifier">targets</span> = [<span class="ruby-identifier">targets</span>].<span class="ruby-identifier">flatten</span>

  <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">subscribe</span>(<span class="ruby-identifier">target</span>[<span class="ruby-value">:agent</span>], <span class="ruby-identifier">target</span>[<span class="ruby-value">:type</span>], <span class="ruby-identifier">target</span>[<span class="ruby-value">:collective</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-subscribe_to_direct_addressing_queue" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">subscribe_to_direct_addressing_queue</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>subscribe to the direct addressing queue</p>
          
          

          
          <div class="method-source-code" id="subscribe_to_direct_addressing_queue-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 508</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">subscribe_to_direct_addressing_queue</span>
  <span class="ruby-identifier">subscribe</span>(<span class="ruby-identifier">make_subscriptions</span>(<span class="ruby-string">&quot;mcollective&quot;</span>, <span class="ruby-value">:directed</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-templatepath" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">templatepath</span><span
            class="method-args">(template_file)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Looks up the template directory and returns its full path</p>
          
          

          
          <div class="method-source-code" id="templatepath-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 498</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">templatepath</span>(<span class="ruby-identifier">template_file</span>)
  <span class="ruby-identifier">config_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-constant">Config</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">configfile</span>)
  <span class="ruby-identifier">template_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">config_dir</span>, <span class="ruby-identifier">template_file</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">template_path</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">template_path</span>)

  <span class="ruby-identifier">template_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;/etc/mcollective&quot;</span>, <span class="ruby-identifier">template_file</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">template_path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-terminal_dimensions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">terminal_dimensions</span><span
            class="method-args">(stdout = STDOUT, environment = ENV)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Figures out the columns and lines of the current tty</p>

<p>Returns [0, 0] if it can&#39;t figure it out or if you&#39;re not running
on a tty</p>
          
          

          
          <div class="method-source-code" id="terminal_dimensions-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 405</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">terminal_dimensions</span>(<span class="ruby-identifier">stdout</span> = <span class="ruby-constant">STDOUT</span>, <span class="ruby-identifier">environment</span> = <span class="ruby-constant">ENV</span>)
  <span class="ruby-keyword">return</span> [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">tty?</span>

  <span class="ruby-keyword">return</span> [<span class="ruby-value">80</span>, <span class="ruby-value">40</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">windows?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">environment</span>[<span class="ruby-string">&quot;COLUMNS&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">environment</span>[<span class="ruby-string">&quot;LINES&quot;</span>]
    <span class="ruby-keyword">return</span> [<span class="ruby-identifier">environment</span>[<span class="ruby-string">&quot;COLUMNS&quot;</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">environment</span>[<span class="ruby-string">&quot;LINES&quot;</span>].<span class="ruby-identifier">to_i</span>]

  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">environment</span>[<span class="ruby-string">&quot;TERM&quot;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">command_in_path?</span>(<span class="ruby-string">&quot;tput&quot;</span>)
    <span class="ruby-keyword">return</span> [<span class="ruby-value">%x`tput cols`</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-value">%x`tput lines`</span>.<span class="ruby-identifier">to_i</span>]

  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">command_in_path?</span>(<span class="ruby-string">&#39;stty&#39;</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-value">%x`stty size`</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\d+/</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span> }
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span>
  [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-unsubscribe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unsubscribe</span><span
            class="method-args">(targets)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Helper to unsubscribe to a topic on multiple collectives or just one</p>
          
          

          
          <div class="method-source-code" id="unsubscribe-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 222</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">unsubscribe</span>(<span class="ruby-identifier">targets</span>)
  <span class="ruby-identifier">connection</span> = <span class="ruby-constant">PluginManager</span>[<span class="ruby-string">&quot;connector_plugin&quot;</span>]

  <span class="ruby-identifier">targets</span> = [<span class="ruby-identifier">targets</span>].<span class="ruby-identifier">flatten</span>

  <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">connection</span>.<span class="ruby-identifier">unsubscribe</span>(<span class="ruby-identifier">target</span>[<span class="ruby-value">:agent</span>], <span class="ruby-identifier">target</span>[<span class="ruby-value">:type</span>], <span class="ruby-identifier">target</span>[<span class="ruby-value">:collective</span>])
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-versioncmp" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">versioncmp</span><span
            class="method-args">(version_a, version_b)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>compare two software versions as commonly found in package versions.</p>

<p>returns 0 if a == b returns -1 if a &lt; b returns 1 if a &gt; b</p>

<p>Code originally from <a href="../Puppet.html">Puppet</a></p>
          
          

          
          <div class="method-source-code" id="versioncmp-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 442</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">versioncmp</span>(<span class="ruby-identifier">version_a</span>, <span class="ruby-identifier">version_b</span>)
  <span class="ruby-identifier">vre</span> = <span class="ruby-regexp">/[-.]|\d+|[^-.\d]+/</span>
  <span class="ruby-identifier">ax</span> = <span class="ruby-identifier">version_a</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">vre</span>)
  <span class="ruby-identifier">bx</span> = <span class="ruby-identifier">version_b</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">vre</span>)

  <span class="ruby-keyword">while</span> (<span class="ruby-identifier">ax</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">bx</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>)
    <span class="ruby-identifier">a</span> = <span class="ruby-identifier">ax</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-identifier">b</span> = <span class="ruby-identifier">bx</span>.<span class="ruby-identifier">shift</span>

    <span class="ruby-keyword">if</span>( <span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">b</span> )                 <span class="ruby-keyword">then</span> <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;-&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;-&#39;</span>) <span class="ruby-keyword">then</span> <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;-&#39;</span>)             <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-value">-1</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">b</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;-&#39;</span>)             <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span>) <span class="ruby-keyword">then</span> <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">a</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span> )            <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-value">-1</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">b</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;.&#39;</span> )            <span class="ruby-keyword">then</span> <span class="ruby-keyword">return</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">a</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\d+$/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\d+$/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">if</span>( <span class="ruby-identifier">a</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^0/</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^0/</span> ) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">upcase</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">to_i</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">upcase</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">upcase</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">version_a</span> <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">version_b</span>;
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-windows-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">windows?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="windows-3F-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 273</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">windows?</span>
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;host_os&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/mswin|win32|dos|mingw|cygwin/i</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-windows_prefix" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">windows_prefix</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the PuppetLabs mcollective path for windows</p>
          
          

          
          <div class="method-source-code" id="windows_prefix-source">
            <pre><span class="ruby-comment"># File lib/mcollective/util.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">windows_prefix</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;win32/dir&#39;</span>
  <span class="ruby-identifier">prefix</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Dir</span><span class="ruby-operator">::</span><span class="ruby-constant">COMMON_APPDATA</span>, <span class="ruby-string">&quot;PuppetLabs&quot;</span>, <span class="ruby-string">&quot;mcollective&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

